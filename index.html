<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>家庭智慧</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
    -webkit-tap-highlight-color: transparent;
    background-color: #F2F2F7;
    overscroll-behavior-y: none;
}
.no-scrollbar::-webkit-scrollbar { display: none; }
.no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
input, select, textarea { font-size: 16px !important; }

#splash-screen {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.6s ease, visibility 0.6s;
}
.breathing { animation: breathe 2s infinite ease-in-out; }
@keyframes breathe {
    0%,100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
}
[v-cloak] { display: none; }
</style>
</head>

<body class="text-[#1D1D1F]">

<div id="splash-screen">
    <div class="breathing flex flex-col items-center">
        <i class="ri-home-heart-fill text-6xl text-blue-500 mb-4"></i>
        <h1 class="text-2xl font-black tracking-widest text-black">家庭智慧</h1>
        <p class="text-xs text-gray-400 mt-2 font-mono uppercase tracking-[0.3em]">Loading Wisdom...</p>
    </div>
    <p id="error-msg" class="text-red-500 text-xs mt-8 px-8 text-center hidden"></p>
</div>

<div id="app" v-cloak>

<header class="fixed top-0 left-0 right-0 z-40 bg-white shadow-sm">
    <div class="px-6 py-3 text-center">
        <h1 class="text-lg font-black">
            <i class="ri-home-heart-fill text-blue-500"></i> 家庭智慧
        </h1>
    </div>
</header>

<div class="h-16"></div>

<main class="px-4 pb-24 space-y-4 max-w-xl mx-auto min-h-screen">

<div v-if="loading" class="text-center py-20 opacity-50">
    <i class="ri-loader-4-line text-3xl animate-spin text-blue-500"></i>
    <p class="text-xs font-bold text-gray-400 mt-2">正在同步家庭数据...</p>
</div>

<div v-if="!loading && filteredList.length === 0" class="text-center py-20 opacity-40">
    <p class="text-sm text-gray-400 font-bold">暂无相关记录</p>
    <button @click="resetFilters" class="text-blue-500 text-xs mt-2 font-bold underline">
        查看全部
    </button>
</div>

<div v-for="item in filteredList" :key="item.id"
class="bg-white rounded-2xl shadow p-4">
    <h3 class="text-lg font-bold mb-2">{{ item.title }}</h3>
    <p class="text-sm text-gray-600">{{ item.content }}</p>
</div>

</main>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>

setTimeout(() => {
    const splash = document.getElementById('splash-screen');
    if (splash && splash.style.opacity !== '0') {
        splash.style.opacity = '0';
        setTimeout(() => splash.style.visibility = 'hidden', 600);
    }
}, 4000);

if (!window.Vue) {
    showError("Vue 加载失败，请检查网络");
}

if (!window.supabase) {
    showError("Supabase SDK 加载失败，请检查网络");
}

function showError(msg) {
    const el = document.getElementById('error-msg');
    el.textContent = msg;
    el.classList.remove('hidden');
}

try {

const { createApp, ref, computed, reactive, onMounted } = Vue;

createApp({
setup() {

const SUPABASE_URL = 'https://ugoksbtsjoktcmukmeuh.supabase.co';
const SUPABASE_KEY = '你的KEY';

let supabase = null;

if (window.supabase) {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
}

const wisdomList = ref([]);
const loading = ref(true);

const currentCategory = ref('全部');
const currentMember = ref('全部成员');

const resetFilters = () => {
    currentCategory.value = '全部';
    currentMember.value = '全部成员';
};

const filteredList = computed(() => wisdomList.value);

const fetchData = async () => {
    if (!supabase) {
        loading.value = false;
        return;
    }

    const { data, error } = await supabase
        .from('family_wisdom')
        .select('*')
        .order('created_at', { ascending: false });

    if (!error) wisdomList.value = data || [];
    loading.value = false;

    const splash = document.getElementById('splash-screen');
    splash.style.opacity = '0';
    setTimeout(() => splash.style.visibility = 'hidden', 600);
};

onMounted(fetchData);

return {
    wisdomList,
    loading,
    filteredList,
    resetFilters
};

}
}).mount('#app');

} catch (e) {
    console.error(e);
    showError("系统初始化失败，请打开控制台查看错误");
}

</script>
</body>
</html>
